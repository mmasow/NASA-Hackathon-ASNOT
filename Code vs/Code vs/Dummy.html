<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dummy Environmental Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .card-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 6px 12px;
            border: 1px solid #007bff;
            background: white;
            color: #007bff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn:hover {
            background: #007bff;
            color: white;
        }

        .chart-container {
            height: 300px;
            padding: 20px;
        }

        .data-source {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 10px;
            padding: 5px 20px;
            background: #f8f9fa;
            border-radius: 4px;
            display: flex;
            align-items: center;
        }

        .data-source-icon {
            margin-right: 5px;
        }

        .data-source-list {
            margin-top: 20px;
            padding: 15px 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .data-source-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .data-source-item:last-child {
            border-bottom: none;
        }

        .api-status {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-active {
            background-color: #2ecc71;
        }

        .status-warning {
            background-color: #f39c12;
        }

        .map-container {
            background: #e8f4f8;
            height: 400px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            color: #666;
            font-style: italic;
        }

        .insights-panel {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .insights-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .insights-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .insights-content {
            padding: 20px;
        }

        .insight-card {
            margin-bottom: 15px;
            padding: 15px;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            background: #fafafa;
        }

        .insight-card.warning {
            border-color: #f39c12;
            background: #fff3cd;
        }

        .insight-title {
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-poor {
            background-color: #e74c3c;
        }

        .status-moderate {
            background-color: #f39c12;
        }

        .insight-text {
            color: #555;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="dashboard">
            <!-- TEMPO Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">TEMPO Satellite Data - NO‚ÇÇ Levels</div>
                    <div class="card-actions">
                        <button class="btn" onclick="updateTimeRange('tempo', '24H')">24H</button>
                        <button class="btn" onclick="updateTimeRange('tempo', '7D')">7D</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="tempoChart"></canvas>
                </div>
                <div class="data-source">
                    <span class="data-source-icon">üõ∞Ô∏è</span>
                    Data Source: NASA TEMPO L2 API (Near Real-Time)
                </div>
            </div>

            <!-- Pollution Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Ground Air Pollution Measurements</div>
                    <div class="card-actions">
                        <button class="btn" onclick="updateTimeRange('pollution', '24H')">24H</button>
                        <button class="btn" onclick="updateTimeRange('pollution', '7D')">7D</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="pollutionChart"></canvas>
                </div>
                <div class="data-source">
                    <span class="data-source-icon">üè≠</span>
                    Data Source: NASA INSTEP Data
                </div>
            </div>

            <!-- AQI Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Air Quality Index (AQI)</div>
                    <div class="card-actions">
                        <button class="btn" onclick="updateTimeRange('aqi', '24H')">24H</button>
                        <button class="btn" onclick="updateTimeRange('aqi', '7D')">7D</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="aqiChart"></canvas>
                </div>
                <div class="data-source">
                    <span class="data-source-icon">üìä</span>
                    Data Source: Composite Index (EPA + TEMPO + Ground Sensors)
                </div>
            </div>
            
            <!-- Data Sources Panel -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Active Data Sources & API Status</div>
                </div>
                <div class="data-source-list">
                    <div class="data-source-item">
                        <div>
                            <span class="api-status status-active"></span>
                            <strong>NASA TEMPO API</strong>
                        </div>
                        <div>Last update: 14:28 EST</div>
                    </div>
                    <div class="data-source-item">
                        <div>
                            <span class="api-status status-active"></span>
                            <strong>EPA AirNow API</strong>
                        </div>
                        <div>Last update: 14:25 EST</div>
                    </div>
                    <div class="data-source-item">
                        <div>
                            <span class="api-status status-active"></span>
                            <strong>National Weather Service</strong>
                        </div>
                        <div>Last update: 14:30 EST</div>
                    </div>
                    <div class="data-source-item">
                        <div>
                            <span class="api-status status-warning"></span>
                            <strong>PurpleAir Network</strong>
                        </div>
                        <div>3 stations offline</div>
                    </div>
                    <div class="data-source-item">
                        <div>
                            <span class="api-status status-active"></span>
                            <strong>OpenWeatherMap</strong>
                        </div>
                        <div>Last update: 14:29 EST</div>
                    </div>
                    <div class="data-source-item">
                        <div>
                            <span class="api-status status-active"></span>
                            <strong>NASA DOAS Ground Sensors</strong>
                        </div>
                        <div>Static Data (2023)</div>
                    </div>
                    <div class="data-source-item">
                        <div>
                            <span class="api-status status-active"></span>
                            <strong>Dummy NASA Ames INSTEP Data</strong>
                        </div>
                        <div>Generated Data</div>
                    </div>
            </div>
            
            <!-- Map Container -->
            <div class="map-container">
                [Interactive Map Showing Pollution Sources and Monitoring Stations]
                <div class="data-source" style="position: absolute; bottom: 10px; left: 10px;">
                    <span class="data-source-icon">üó∫Ô∏è</span>
                    Map Data: OpenStreetMap + TEMPO Overlay + Facility Registry
                </div>
            </div>
            
            <!-- Insights Panel -->
            <div class="insights-panel">
                <div class="insights-header">
                    <div class="insights-title">Data Insights & Anomaly Detection</div>
                    <div class="card-actions">
                        <button class="btn" onclick="refreshInsights()">Refresh</button>
                    </div>
                </div>
                <div class="insights-content" id="insightsContainer">
                    <!-- Insights will be populated by JavaScript -->
                </div>
                <div class="data-source">
                    <span class="data-source-icon">ü§ñ</span>
                    Insights generated by Dummy ML Anomaly Detection Engine
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data Sources Configuration
        const DATA_SOURCES = {
            tempo: {
                name: "NASA TEMPO API",
                status: "active"
            },
            aqi: {
                name: "Composite Data Fusion Engine",
                status: "active"
            },
            pollution: {
                name: "NASA INSTEP Data",
                status: "active"
            }
        };

        // Global data storage
        let doasData = null;

        // Load INSTEP data from .ict file
        async function loadDOASData() {
            if (doasData) return doasData;
            try {

                const response = await fetch('../staqs-AFRC-CH4-CH2O-O3-CO2_INSTEP_20230607_R0.ict');


                const text = await response.text();

                const lines = text.split('\n');

                // Find the header line

                let headerIndex = -1;

                for (let i = 0; i < lines.length; i++) {

                    if (lines[i].includes('Time_Start,Time_Stop,Time_Mid,CH4,CH2O,O3,CO2,Latitude,Longitude')) {

                        headerIndex = i;

                        break;

                    }

                }

                if (headerIndex === -1) throw new Error('Header not found');

                const dataLines = lines.slice(headerIndex + 1);

                const data = [];
                for (const line of dataLines) {
                    if (line.trim() === '') continue;
                    const parts = line.split('\t');
                    if (parts.length >= 5) {
                        const time = new Date(parts[0]);
                        const ch4 = parseFloat(parts[1]);
                        const ch2o = parseFloat(parts[2]);
                        const o3 = parseFloat(parts[3]);
                        const co2 = parseFloat(parts[4]);
                        if (!isNaN(time.getTime()) && !isNaN(ch4) && !isNaN(ch2o) && !isNaN(o3) && !isNaN(co2)) {
                            data.push({ time, ch4, ch2o, o3, co2 });
                        }
                    }
                }
                doasData = data;
                return data;
            } catch (error) {
                console.error('Error loading DOAS data:', error);
                // Fallback to dummy data
                const data = [];
                const startTime = new Date('2023-06-07T00:00:00Z');
                for (let i = 0; i < 144; i++) { // 6 hours of data (10 min intervals)
                    const time = new Date(startTime.getTime() + i * 10 * 60 * 1000);
                    data.push({
                        time: time,
                        ch4: 1800 + Math.random() * 200, // ppb
                        ch2o: 2.5 + Math.random() * 1, // ppb
                        o3: 35 + Math.random() * 10, // ppb
                        co2: 420 + Math.random() * 20 // ppm
                    });
                }
                doasData = data;
                return data;
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            loadInsights();
        });

        // Chart initialization
        async function initializeCharts() {
            // TEMPO Chart
            const tempoCtx = document.getElementById('tempoChart').getContext('2d');
            const tempoData = await fetchTEMPOData('24H');
            window.tempoChart = new Chart(tempoCtx, {
                type: 'line',
                data: tempoData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Pollution Chart
            const pollutionCtx = document.getElementById('pollutionChart').getContext('2d');
            const pollutionData = await fetchPollutionData('24H');
            window.pollutionChart = new Chart(pollutionCtx, {
                type: 'line',
                data: pollutionData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Concentration'
                            }
                        }
                    }
                }
            });

            // AQI Chart
            const aqiCtx = document.getElementById('aqiChart').getContext('2d');
            const aqiData = await fetchAQIData('24H');
            window.aqiChart = new Chart(aqiCtx, {
                type: 'line',
                data: aqiData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        async function fetchTEMPOData(range) {
            // Simulated TEMPO data fetch
            return {
                labels: ['00:00', '02:00', '04:00', '06:00', '08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00', '22:00'],
                datasets: [
                    {
                        label: 'NO‚ÇÇ Levels',
                        data: [1.2, 1.4, 1.3, 1.8, 2.2, 2.5, 2.8, 3.1, 2.9, 2.5, 2.1, 1.7],
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        tension: 0.4
                    }
                ]
            };
        }

        async function fetchAQIData(range) {
            // Simulated AQI data
            return {
                labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
                datasets: [
                    {
                        label: 'AQI',
                        data: [45, 52, 48, 65, 78, 62],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4
                    }
                ]
            };
        }

        async function fetchPollutionData(range) {
            const data = await loadDOASData();
            // Sample data for performance, take every 10th point
            const sampledData = data.filter((_, i) => i % 10 === 0);
            const labels = sampledData.map(d => d.time.toLocaleString());
            return {
                labels,
                datasets: [
                    {
                        label: 'CH4 (ppb)',
                        data: sampledData.map(d => d.ch4),
                        borderColor: '#9b59b6',
                        backgroundColor: 'rgba(155, 89, 182, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'CH2O (ppb)',
                        data: sampledData.map(d => d.ch2o),
                        borderColor: '#f39c12',
                        backgroundColor: 'rgba(243, 156, 18, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'O3 (ppb)',
                        data: sampledData.map(d => d.o3),
                        borderColor: '#2ecc71',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'CO2 (ppm)',
                        data: sampledData.map(d => d.co2),
                        borderColor: '#e67e22',
                        backgroundColor: 'rgba(230, 126, 34, 0.1)',
                        tension: 0.4
                    }
                ]
            };
        }

        function updateTimeRange(chartType, range) {
            console.log(`Updating ${chartType} chart for ${range}`);
            // In a full implementation, this would fetch new data and update the chart
        }

        function loadInsights() {
            const insights = [
                {
                    title: "Elevated NO‚ÇÇ Levels Detected",
                    text: "TEMPO satellite data shows increased nitrogen dioxide levels.",
                    status: "poor",
                    source: "NASA TEMPO + Anomaly Detection"
                },
                {
                    title: "Weather Impact on Pollution",
                    text: "Low wind speeds may affect pollutant dispersion.",
                    status: "moderate",
                    source: "Weather Data Correlation"
                }
            ];

            const container = document.getElementById('insightsContainer');
            container.innerHTML = insights.map(insight => `
                <div class="insight-card ${insight.status === 'poor' ? 'warning' : ''}">
                    <div class="insight-title">
                        <span class="status-indicator status-${insight.status}"></span>
                        ${insight.title}
                    </div>
                    <div class="insight-text">${insight.text}</div>
                    <div class="data-source" style="margin-top: 8px; font-size: 11px;">
                        Source: ${insight.source}
                    </div>
                </div>
            `).join('');
        }

        function refreshInsights() {
            console.log("Refreshing insights...");
            loadInsights();
        }
    </script>
</body>
</html>
